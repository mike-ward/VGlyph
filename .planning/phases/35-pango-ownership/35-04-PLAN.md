---
phase: 35-pango-ownership
plan: 04
type: execute
wave: 4
depends_on: ["35-03"]
files_modified: []
autonomous: true
must_haves:
  truths:
    - "No manual g_object_unref calls for wrapped types in codebase"
    - "No manual pango_*_free calls for wrapped types in codebase"
    - "AttrList debug tracking still functions"
    - "All code compiles and tests pass"
  artifacts:
    - path: "pango_wrappers.v"
---

<objective>
Final audit and cleanup of Pango memory management refactoring. Ensure all manual cleanup calls are replaced and verification utilities are intact.
</objective>

<execution_context>
@/Users/mike/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@pango_wrappers.v
@layout_attributes.v
</context>

<tasks>

<task type="auto">
  <name>Final Codebase Audit</name>
  <files>layout.v, context.v, layout_pango.v, layout_iter.v, layout_attributes.v</files>
  <action>
    - Scan for any remaining `g_object_unref`, `pango_font_description_free`, `pango_layout_iter_free`, `pango_attr_list_unref` calls.
    - If any remain for wrapped types, replace them with wrapper `.free()` calls.
    - Ensure `check_attr_list_leaks` logic in `layout_attributes.v` is preserved and correct.
  </action>
  <verify>
    Run `grep` commands to confirm absence of manual free calls for wrapped types.
  </verify>
  <done>
    Refactoring is complete and verified.
  </done>
</task>

<task type="auto">
  <name>Run Verification</name>
  <files>_validation_test.v</files>
  <action>
    - Run all project tests (`v test .`).
    - Specifically ensure memory safety tests (if any) pass.
  </action>
  <verify>
    Tests pass.
  </verify>
  <done>
    System is stable.
  </done>
</task>

</tasks>

<success_criteria>
- Project compiles successfully.
- All tests pass.
- No regression in memory management (no leaks, no double frees).
</success_criteria>

<output>
After completion, create `.planning/phases/35-pango-ownership/35-04-SUMMARY.md`
</output>
