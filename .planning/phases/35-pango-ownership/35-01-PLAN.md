---
phase: 35-pango-ownership
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [pango_wrappers.v]
autonomous: true
must_haves:
  truths:
    - "PangoLayout wrapper exists with g_object_unref in free()"
    - "PangoContext wrapper exists with g_object_unref in free()"
    - "PangoAttrList wrapper exists with pango_attr_list_unref and debug tracking"
    - "PangoFontDescription wrapper exists with pango_font_description_free"
    - "PangoFontMap and PangoFont wrappers exist"
    - "PangoLayoutIter, PangoFontMetrics, and PangoTabArray wrappers exist"
  artifacts:
    - path: "pango_wrappers.v"
      provides: "RAII wrappers for Pango types"
---

<objective>
Create a new file `pango_wrappers.v` containing V structs that wrap Pango C pointers and provide `free()` methods for safe resource cleanup.
</objective>

<execution_context>
@/Users/mike/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@c_bindings.v
@layout_attributes.v (for tracking logic)
</context>

<tasks>

<task type="auto">
  <name>Create pango_wrappers.v</name>
  <files>pango_wrappers.v</files>
  <action>
    Define the following structs in `module vglyph`:
    - `PangoLayout` wrapping `&C.PangoLayout`
    - `PangoContext` wrapping `&C.PangoContext`
    - `PangoAttrList` wrapping `&C.PangoAttrList`
    - `PangoFontDescription` wrapping `&C.PangoFontDescription`
    - `PangoFontMap` wrapping `&C.PangoFontMap`
    - `PangoFont` wrapping `&C.PangoFont`
    - `PangoLayoutIter` wrapping `&C.PangoLayoutIter`
    - `PangoFontMetrics` wrapping `&C.PangoFontMetrics`
    - `PangoTabArray` wrapping `&C.PangoTabArray`

    Each struct must have:
    - A `ptr` field with the corresponding C type (default to `unsafe { nil }`).
    - A `free()` method that checks if `ptr` is not nil and calls the appropriate Pango/GObject free function.
    - `PangoAttrList.free()` must call `track_attr_list_free()` before `C.pango_attr_list_unref()`.
    - `is_nil() bool` helper.

    Include a `new_pango_attr_list()` factory function that calls `track_attr_list_alloc()`.
  </action>
  <verify>
    Verify file exists and compiles with `v .`.
  </verify>
  <done>
    Wrappers are defined and handle cleanup correctly.
  </done>
</task>

</tasks>

<success_criteria>
- `pango_wrappers.v` exists and contains all required wrappers.
- `PangoAttrList` properly integrates with existing debug tracking.
- Code compiles.
</success_criteria>

<output>
After completion, create `.planning/phases/35-pango-ownership/35-01-SUMMARY.md`
</output>
