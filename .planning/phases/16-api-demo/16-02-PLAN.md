---
phase: 16-api-demo
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - examples/editor_demo.v
autonomous: false
must_haves:
  truths:
    - Demo shows status bar with line:col
    - Demo shows selection length when selection active
    - Demo shows undo stack depth
    - Demo text includes emoji for grapheme testing
  artifacts:
    - path: examples/editor_demo.v
      provides: Enhanced editor demo with status bar
      contains: "Line:"
  key_links:
    - from: examples/editor_demo.v
      to: layout_query.v
      via: cursor position calculation
      pattern: get_cursor_pos|get_valid_cursor_positions
---

<objective>
Enhance editor demo with status bar and improved test content.

Purpose: API-02, API-03 requirements - demo demonstrates all editing operations.
Output: Enhanced editor_demo.v with status bar showing editing state.
</objective>

<execution_context>
@/Users/mike/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mike/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-api-demo/16-CONTEXT.md
@.planning/phases/16-api-demo/16-RESEARCH.md
@examples/editor_demo.v
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add status bar to demo</name>
  <files>examples/editor_demo.v</files>
  <action>
Enhance editor_demo.v to display status bar at bottom of window:

1. Add fields to EditorState for tracking:
   - current_line int
   - current_col int

2. Create helper function to calculate line:col from cursor_idx:
   - Iterate through layout.lines to find which line contains cursor
   - Column = cursor_idx - line.start_index
   - Store line number (1-indexed for display)

3. Update frame() to draw status bar:
   - Position at bottom: y = window_height - 30
   - Left side: "Line: N  Col: M"
   - Center: selection info if has_selection: "Sel: N chars"
   - Right side: "Undo: N" (from undo_mgr.can_undo() ? stack depth : 0)

4. Update cursor position calculation after any cursor movement:
   - In event() after cursor changes
   - In frame() is fine for simplicity (recalculate each frame)

Use layout.lines array which has start_index and length for each line.
Color: use gg.gray for status bar text.
  </action>
  <verify>
v -check-syntax examples/editor_demo.v
v run examples/editor_demo.v (manual check - status bar visible)
  </verify>
  <done>Status bar displays Line:Col, selection length, undo depth</done>
</task>

<task type="auto">
  <name>Task 2: Update demo content with emoji</name>
  <files>examples/editor_demo.v</files>
  <action>
Update initial text content in main() to include:

1. Descriptive header about editing features
2. Emoji cluster examples:
   - Simple emoji: rainbow, star, heart
   - Compound emoji: flag (regional indicators), family (ZWJ sequence)
   - Skin tone modifier emoji
3. Multi-line lorem ipsum for testing selection/scrolling
4. Instructions for testing:
   - Arrow key navigation
   - Word/line deletion (Cmd+Backspace, Option+Backspace)
   - Undo/redo (Cmd+Z, Cmd+Shift+Z)
   - IME (switch keyboard, type accented chars)

Example content structure:
```
VGlyph Editor Demo

Try cursor navigation: Arrow keys, Cmd+Arrow for words
Try selection: Shift+Arrow, double-click word, triple-click paragraph
Try editing: Type, Backspace, Delete
Try undo: Cmd+Z, Cmd+Shift+Z

Emoji tests:
Simple: * heart * rainbow
Compound: flag sequence, family
With modifier: waving hand

Lorem ipsum dolor sit amet...
```

Keep total content reasonable (not too long for demo purposes).
  </action>
  <verify>v -check-syntax examples/editor_demo.v</verify>
  <done>Demo text includes emoji clusters and editing feature instructions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced editor demo with status bar and emoji test content</what-built>
  <how-to-verify>
1. Run: v run examples/editor_demo.v
2. Verify status bar at bottom shows:
   - Line:Col updates as cursor moves
   - Selection length appears when text selected
   - Undo depth shows after making edits
3. Verify emoji renders correctly:
   - Flag emoji shows as single unit
   - Family emoji clusters together
4. Test cursor navigation through emoji:
   - Arrow keys skip whole emoji, not bytes
5. Test undo/redo:
   - Type some text, Cmd+Z undoes it
   - Cmd+Shift+Z redoes it
6. Test IME (if available):
   - Switch to ABC Extended keyboard
   - Type Option+` then e for e with grave accent
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- v -check-syntax examples/editor_demo.v
- v fmt -w examples/editor_demo.v
- Manual: run demo and verify all status bar elements visible
</verification>

<success_criteria>
1. Demo compiles without errors
2. Status bar visible at window bottom
3. Line:Col updates correctly with cursor movement
4. Selection length displayed when text selected
5. Undo depth indicator present
6. Emoji clusters render and navigate correctly
</success_criteria>

<output>
After completion, create `.planning/phases/16-api-demo/16-02-SUMMARY.md`
</output>
