---
phase: 16-api-demo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - layout_query.v
  - layout_mutation.v
  - undo.v
  - composition.v
  - docs/EDITING.md
  - docs/IME-APPENDIX.md
autonomous: true
must_haves:
  truths:
    - All pub fn in editing modules have docstrings
    - EDITING.md covers cursor, selection, mutation, undo, IME
    - IME-APPENDIX.md documents dead keys and future CJK plans
  artifacts:
    - path: docs/EDITING.md
      provides: Editing API guide
      min_lines: 150
    - path: docs/IME-APPENDIX.md
      provides: IME documentation
      min_lines: 50
  key_links:
    - from: docs/EDITING.md
      to: layout_query.v
      via: API references
      pattern: move_cursor|get_cursor_pos|get_selection
    - from: docs/EDITING.md
      to: layout_mutation.v
      via: Mutation API references
      pattern: insert_text|delete_backward|MutationResult
---

<objective>
Document VGlyph editing APIs with inline docstrings and markdown guides.

Purpose: API-01 requirement - editing API documented with examples.
Output: Complete docstrings in source files, EDITING.md guide, IME-APPENDIX.md.
</objective>

<execution_context>
@/Users/mike/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mike/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-api-demo/16-CONTEXT.md
@.planning/phases/16-api-demo/16-RESEARCH.md
@docs/API.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and complete inline docstrings</name>
  <files>layout_query.v, layout_mutation.v, undo.v, composition.v</files>
  <action>
Review all pub fn in editing modules. For each function:
1. Check existing docstring completeness
2. Add/update docstring following V convention: `// fn_name does X`
3. Include parameter descriptions for non-obvious params
4. Note return type semantics (?T = Option, returns none if invalid)

Focus areas from RESEARCH.md:
- layout_query.v: get_cursor_pos, move_cursor_*, get_selection_rects, get_word_at_index
- layout_mutation.v: insert_text, delete_backward, MutationResult struct
- undo.v: UndoManager methods, coalescing behavior
- composition.v: CompositionState, DeadKeyState, ClauseRects

Verify existing docstrings are accurate. Fix any signature mismatches.
Run `v fmt -w` on each file after edits.
  </action>
  <verify>
grep -c "^// " layout_query.v layout_mutation.v undo.v composition.v
All pub fn should have preceding comment
  </verify>
  <done>Every pub fn has complete docstring describing behavior and return semantics</done>
</task>

<task type="auto">
  <name>Task 2: Create EDITING.md guide</name>
  <files>docs/EDITING.md</files>
  <action>
Create editing API guide following structure from RESEARCH.md:

1. Quick Start - minimal example showing text mutation
2. Cursor API - positioning (get_cursor_pos), navigation (move_cursor_*)
3. Selection API - get_selection_rects, get_word_at_index, anchor-focus model
4. Mutation API - insert_text, delete_*, MutationResult pattern, strings.Builder usage
5. Undo API - UndoManager, coalescing (1s timeout), break_coalescing for navigation
6. IME API - CompositionState, DeadKeyState, callback registration (brief, link to appendix)
7. Integration Patterns - brief note about v-gui integration (state management pattern)

Keep examples minimal per CONTEXT.md decision - show API calls, assume context.
Use V code snippets from editor_demo.v as reference.
Limit lines to 99 chars per CLAUDE.md.
Run `v check-md -w docs/EDITING.md` after creation.
  </action>
  <verify>wc -l docs/EDITING.md (should be 150+ lines)</verify>
  <done>EDITING.md covers all 6 API categories with working code examples</done>
</task>

<task type="auto">
  <name>Task 3: Create IME-APPENDIX.md</name>
  <files>docs/IME-APPENDIX.md</files>
  <action>
Create IME appendix documenting:

1. Current State
   - Dead key composition works (grave, acute, circumflex, tilde, umlaut, cedilla)
   - macOS NSTextInputClient bridge implemented
   - Callback registration pattern: ime_register_callbacks

2. Dead Key Usage
   - Table of supported combinations
   - Code example of try_combine usage

3. IME Composition State
   - CompositionState lifecycle (start -> set_marked_text -> commit/cancel)
   - ClauseRects for underline rendering
   - Preedit text display

4. Future Work (CJK IME)
   - Current limitation: NSView category doesn't connect to MTKView
   - Required: sokol modification or overlay view
   - Multi-clause support structure exists (Clause struct, styles)

Limit lines to 99 chars per CLAUDE.md.
Run `v check-md -w docs/IME-APPENDIX.md` after creation.
  </action>
  <verify>wc -l docs/IME-APPENDIX.md (should be 50+ lines)</verify>
  <done>IME-APPENDIX.md documents working features and future CJK roadmap</done>
</task>

</tasks>

<verification>
- v fmt -w layout_query.v layout_mutation.v undo.v composition.v
- v check-md -w docs/EDITING.md
- v check-md -w docs/IME-APPENDIX.md
- grep "^pub fn" layout_query.v | wc -l matches docstring count
</verification>

<success_criteria>
1. All pub fn in editing modules have accurate docstrings
2. docs/EDITING.md exists with 150+ lines covering all editing APIs
3. docs/IME-APPENDIX.md exists with 50+ lines
4. Markdown files pass v check-md validation
</success_criteria>

<output>
After completion, create `.planning/phases/16-api-demo/16-01-SUMMARY.md`
</output>
