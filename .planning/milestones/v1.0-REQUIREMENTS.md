# Requirements Archive: v1.0 Memory & Safety Hardening

**Archived:** 2026-02-01
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: VGlyph Memory & Safety Hardening

**Defined:** 2026-02-01
**Core Value:** Prevent crashes and undefined behavior from memory safety issues

## v1 Requirements

### Memory Operations (glyph_atlas.v)

- [x] **MEM-01**: Add null check after vcalloc at line 72 before dereferencing
- [x] **MEM-02**: Add null check after vcalloc at line 389 before dereferencing
- [x] **MEM-03**: Add null check after vcalloc at line 439 before dereferencing
- [x] **MEM-04**: Add null checks after vcalloc at lines 447-450 before dereferencing
- [x] **MEM-05**: Validate width * height doesn't overflow before allocation

### Error Propagation (glyph_atlas.v)

- [x] **ERR-01**: Change new_glyph_atlas return type to `!GlyphAtlas`
- [x] **ERR-02**: Replace assert at line 49 with error return
- [x] **ERR-03**: Replace assert at line 53 with error return
- [x] **ERR-04**: Replace assert at line 73 with error return for allocation failure
- [x] **ERR-05**: Update all callers to handle GlyphAtlas error

### Pointer Safety (layout.v)

- [x] **PTR-01**: Document unsafe pointer cast assumption at line 156
- [x] **PTR-02**: Add $if debug block with runtime type validation

### String Lifetime (layout.v)

- [x] **STR-01**: Clone object.id string before storing in Pango attribute
- [x] **STR-02**: Free cloned string when layout is destroyed

## v2 Requirements

(None - all memory/safety issues addressed in v1)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Performance optimizations | Separate CONCERNS.md section, different scope |
| Tech debt cleanup | Separate CONCERNS.md section, different scope |
| Test coverage expansion | Separate CONCERNS.md section, different scope |
| Dependency version pinning | Separate CONCERNS.md section, different scope |
| Thread safety | V is single-threaded by design per CONCERNS.md |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| MEM-01 | Phase 2 | Complete |
| MEM-02 | Phase 2 | Complete |
| MEM-03 | Phase 2 | Complete |
| MEM-04 | Phase 2 | Complete |
| MEM-05 | Phase 2 | Complete |
| ERR-01 | Phase 1 | Complete |
| ERR-02 | Phase 1 | Complete |
| ERR-03 | Phase 1 | Complete |
| ERR-04 | Phase 1 | Complete |
| ERR-05 | Phase 1 | Complete |
| PTR-01 | Phase 3 | Complete |
| PTR-02 | Phase 3 | Complete |
| STR-01 | Phase 3 | Complete |
| STR-02 | Phase 3 | Complete |

**Coverage:**
- v1 requirements: 14 total
- Mapped to phases: 14
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 14 of 14 v1 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-01 as part of v1.0 milestone completion*
