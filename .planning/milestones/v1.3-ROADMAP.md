# Milestone v1.3: Text Editing

**Status:** SHIPPED 2026-02-03
**Phases:** 11-17
**Total Plans:** 15

## Overview

Text editing milestone adding cursor, selection, mutation, undo/redo, IME composition, and
VoiceOver accessibility to VGlyph. Enables v-gui TextField/TextArea widgets.

## Phases

### Phase 11: Cursor Foundation

**Goal**: User can position and navigate cursor within text.
**Depends on**: None (uses existing Layout hit testing APIs)
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md — Pango cursor bindings + CursorPosition geometry API
- [x] 11-02-PLAN.md — Cursor movement APIs + keyboard navigation demo

**Details:**
- Click-to-position cursor using Layout hit testing
- 8 cursor movement methods (left/right/word/line/up/down)
- Grapheme cluster handling for emoji and multi-byte characters
- Byte-to-logattr mapping for UTF-8 correctness

---

### Phase 12: Selection

**Goal**: User can select text ranges for copy/cut operations.
**Depends on**: Phase 11 (cursor positioning)
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — Selection state + click-drag + auto-scroll
- [x] 12-02-PLAN.md — Keyboard selection + multi-click word/paragraph

**Details:**
- Anchor-focus selection model
- Click-drag with Option+drag word snap
- Auto-scroll during drag (when content exceeds visible area)
- Shift+Arrow keyboard selection
- Double-click word, triple-click paragraph

---

### Phase 13: Text Mutation

**Goal**: User can insert, delete, and modify text content.
**Depends on**: Phase 11 (cursor), Phase 12 (selection for replace)
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md — Core mutation APIs (MutationResult, delete/insert)
- [x] 13-02-PLAN.md — Clipboard support + editor demo integration

**Details:**
- Pure function mutation (returns MutationResult, app applies changes)
- strings.Builder for O(n) string construction
- Character insert at cursor with selection replacement
- Backspace/Delete with word/line modifiers
- Clipboard cut/copy/paste

---

### Phase 14: Undo/Redo

**Goal**: User can revert and reapply text mutations.
**Depends on**: Phase 13 (mutation operations)
**Plans**: 2 plans

Plans:
- [x] 14-01-PLAN.md — Core undo infrastructure (UndoManager, UndoOperation, undo/redo API)
- [x] 14-02-PLAN.md — Editor demo integration (Cmd+Z, Cmd+Shift+Z keyboard handlers)

**Details:**
- Arrays over datatypes.Stack for O(1) history trimming
- 1 second coalescing timeout
- 100-entry history limit
- Navigation keys break coalescing for natural undo boundaries

---

### Phase 15: IME Integration (PARTIAL)

**Goal**: User can input CJK and accented characters via system IME.
**Depends on**: Phase 11 (cursor geometry), Phase 13 (text insertion)
**Plans**: 3 plans

Plans:
- [x] 15-01-PLAN.md — Core composition state types (CompositionState, DeadKeyState)
- [x] 15-02-PLAN.md — Native macOS bridge (NSTextInputClient protocol)
- [x] 15-03-PLAN.md — Editor demo integration + human verification (PARTIAL)

**Details:**
- Dead key composition works (grave, acute, circumflex, tilde, umlaut, cedilla)
- CJK IME blocked by sokol architecture (NSView category doesn't affect MTKView)
- NSTextInputClient bridge implemented but cannot connect to sokol's Metal view

---

### Phase 16: API & Demo

**Goal**: Clean editing API surface and working demo application.
**Depends on**: Phases 11-15 (all VGlyph editing primitives)
**Plans**: 2 plans

Plans:
- [x] 16-01-PLAN.md — API documentation (docstrings, EDITING.md, IME-APPENDIX.md)
- [x] 16-02-PLAN.md — Demo enhancement (status bar, emoji content)

**Details:**
- EDITING.md comprehensive API guide
- IME-APPENDIX.md for composition details
- Status bar with Line:Col, selection length, undo depth
- Emoji test content for grapheme cluster validation

---

### Phase 17: Accessibility

**Goal**: VoiceOver users can navigate and edit text with full screen reader support.
**Depends on**: Phases 11-15 (editing APIs)
**Plans**: 2 plans

Plans:
- [x] 17-01-PLAN.md — Text field types + notification infrastructure
- [x] 17-02-PLAN.md — Announcer + editor demo integration + verification

**Details:**
- AccessibilityAnnouncer with verbosity-aware announcements
- Option+Arrow word movement, Cmd+Arrow line start/end (macOS standard)
- 150ms debounce per screen reader research
- Emoji short name lookup for VoiceOver

---

## Milestone Summary

**Key Decisions:**
- Byte-to-logattr mapping for UTF-8/emoji cursor handling
- Anchor-focus selection model with Option+drag word snap
- Pure function mutation (MutationResult pattern)
- 1 second coalescing timeout for undo grouping
- NSView category approach for IME (blocked by sokol MTKView)
- 150ms debounce for accessibility announcements

**Issues Resolved:**
- Emoji cursor navigation (log_attr_by_index mapping)
- Selection flicker during drag (rightmost char detection)
- Multi-byte character handling in all cursor operations
- ARC bridging for accessibility notifications

**Issues Deferred:**
- CJK IME composition (blocked until sokol modification)
- Full NSAccessibility tree integration (announcer works instead)

**Technical Debt Incurred:**
- ime_bridge_macos.m orphaned (cannot connect to sokol MTKView)
- TextChange.to_change() created but unused (MutationResult used directly)
- DarwinAccessibilityBackend stubs (announcer provides functional alternative)

---

*For current project status, see .planning/ROADMAP.md*
